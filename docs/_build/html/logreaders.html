

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Log Readers &mdash; Ceda Elasticsearch Tools 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Index Updaters" href="index_updaters.html" />
    <link rel="prev" title="Welcome to Ceda Elasticsearch Tools’s documentation!" href="index.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Ceda Elasticsearch Tools
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Log Readers</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_updaters.html">Index Updaters</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ceda Elasticsearch Tools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Log Readers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/logreaders.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="log-readers">
<h1>Log Readers<a class="headerlink" href="#log-readers" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><span class="target" id="module-ceda_elasticsearch_tools.core.log_reader"></span><dl class="class">
<dt id="ceda_elasticsearch_tools.core.log_reader.SpotMapping">
<em class="property">class </em><code class="descclassname">ceda_elasticsearch_tools.core.log_reader.</code><code class="descname">SpotMapping</code><span class="sig-paren">(</span><em>test=False</em>, <em>spot_file=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.SpotMapping" title="Permalink to this definition">¶</a></dt>
<dd><p>Downloads the spot mapping from the cedaarchiveapp.
Makes two queryable dicts:</p>
<blockquote>
<div><ul class="simple">
<li>spot2pathmapping = provide spot and return file path</li>
<li>path2spotmapping = provide a file path and the spot will be returned</li>
</ul>
</div></blockquote>
<dl class="method">
<dt id="ceda_elasticsearch_tools.core.log_reader.SpotMapping.get_archive_root">
<code class="descname">get_archive_root</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.SpotMapping.get_archive_root" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>key</strong> – Provide the spot</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Returns the directory mapped to that spot</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ceda_elasticsearch_tools.core.log_reader.SpotMapping.get_spot">
<code class="descname">get_spot</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.SpotMapping.get_spot" title="Permalink to this definition">¶</a></dt>
<dd><p>The directory stored in elasticsearch is the basename for the specific file. The directory stored on the spots
page is further up the directory structure but there is no common cut off point as it depends on how many files there
are in each dataset. This function recursively starts at the end of the directory stored in elasticsearch
and gradually moves back up the file structure until it finds a match in the path2spot dict.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>key</strong> – Provide a filename or directory</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Returns the spot which encompasses that file or directory.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ceda_elasticsearch_tools.core.log_reader.SpotMapping.get_spot_from_storage_path">
<code class="descname">get_spot_from_storage_path</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.SpotMapping.get_spot_from_storage_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the spot name from the storage path</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> – Path to test</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">spot name and path suffix</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ceda_elasticsearch_tools.core.log_reader.SpotMapping.is_archive_path">
<code class="descname">is_archive_path</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.SpotMapping.is_archive_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Archive path refers to the location in the archive where the file exists.
In the archive there are 3 path types:</p>
<blockquote>
<div><ul class="simple">
<li>storage path: the actual location of the file eg. /datacentre/archvol3/pan125/archive/namblex/data/…</li>
<li>archive path: the path with the spot mapping replacing the storage prefix eg. /badc/namblex/data/aber-radar-1290mhz/20020831/</li>
<li>symlink path: an alternative route to the file as displayed using pydap eg. badc/ncas-observations/data/man-radar-1290mhz/previous-versions/2002/08/31/</li>
</ul>
</div></blockquote>
<p>This function takes the input path, gets the storage path, replaces the storage prefix with spot mapping to get the archive
path and compares it to the input path. Returns True if input path is archive path.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> – file path to test</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Bool</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ceda_elasticsearch_tools.core.log_reader.MD5LogFile">
<em class="property">class </em><code class="descclassname">ceda_elasticsearch_tools.core.log_reader.</code><code class="descname">MD5LogFile</code><span class="sig-paren">(</span><em>spot</em>, <em>base_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.MD5LogFile" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the log file and creates a dictionary which can be queried using get_md5 and a test string.</p>
<dl class="method">
<dt id="ceda_elasticsearch_tools.core.log_reader.MD5LogFile.get_md5">
<code class="descname">get_md5</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.MD5LogFile.get_md5" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the md5 checksum given a filepath.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> – full file path of the object to get md5 for.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the md5 checksum. If file not found, returns empty string.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ceda_elasticsearch_tools.core.log_reader.DepositLog">
<em class="property">class </em><code class="descclassname">ceda_elasticsearch_tools.core.log_reader.</code><code class="descname">DepositLog</code><span class="sig-paren">(</span><em>log_filename=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.DepositLog" title="Permalink to this definition">¶</a></dt>
<dd><p>Object to read an use deposit log file to update elasticsearch and generate md5 checksums.</p>
<dl class="method">
<dt id="ceda_elasticsearch_tools.core.log_reader.DepositLog.generate_md5">
<code class="descname">generate_md5</code><span class="sig-paren">(</span><em>file</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.DepositLog.generate_md5" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate md5 checksum for input file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>file</strong> – Full path to a real file on the system.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">md5 checksum or “” if file not found.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ceda_elasticsearch_tools.core.log_reader.DepositLog.es_deposits_diff">
<code class="descname">es_deposits_diff</code><span class="sig-paren">(</span><em>index=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ceda_elasticsearch_tools.core.log_reader.DepositLog.es_deposits_diff" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks at the log files from oldest to newest and checks elasticsearch to see if those files are in.
Generates a list of files to index.
:return: None</p>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="index_updaters.html" class="btn btn-neutral float-right" title="Index Updaters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to Ceda Elasticsearch Tools’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Richard Smith.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>